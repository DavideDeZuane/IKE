\documentclass[
10pt, % Main document font size
a4paper, % Paper type, use 'letterpaper' for US Letter paper
oneside, % One page layout (no page indentation)
%twoside, % Two page layout (page indentation for binding and different headers)
headinclude,footinclude, % Extra spacing for the header and footer
BCOR5mm, % Binding correction
]{scrartcl}

\usepackage{listings}
\usepackage{dirtree}
\usepackage{adjustbox}

\lstset{
    backgroundcolor=\color{white},
    language=bash,
    basicstyle=\ttfamily\small, % Imposta lo stile del testo
    keywordstyle=[1]{\color{blue}}, % Imposta il colore delle parole chiave
    morekeywords=[1]{pki}, 
    deletekeywords=[1]{type},
    keywordstyle=[2]{\color{green!40}}, % Imposta il colore delle parole chiave
    morekeywords=[2]{\$}, 
    stringstyle=\color{red}, % Imposta il colore delle stringhe
    breaklines=true, % Esegue il wrapping delle linee se troppo lunghe
    frame=single, % Inserisce una cornice intorno al codice
    frameround=12,
}


\input{structure.tex} % Include the structure.tex file which specified the document structure and layout

\hyphenation{Fortran hy-phen-ation} % Specify custom hyphenation points in words with dashes where you would like hyphenation to occur, or alternatively, don't put any dashes in a word to stop hyphenation altogether

%----------------------------------------------------------------------------------------
%	TITLE AND AUTHOR(S)
%----------------------------------------------------------------------------------------

\title{\normalfont\spacedallcaps{IKEv2 Testing}} % The article title

%\subtitle{Subtitle} % Uncomment to display a subtitle

\author{\spacedlowsmallcaps{Davide De Zuane \& Rahmi El Mechri}} % The article author(s) - author affiliations need to be specified in the AUTHOR AFFILIATIONS block

\date{} % An optional date to appear under the author(s)

%----------------------------------------------------------------------------------------

\begin{document}

%----------------------------------------------------------------------------------------
%	HEADERS
%----------------------------------------------------------------------------------------

\renewcommand{\sectionmark}[1]{\markright{\spacedlowsmallcaps{#1}}} % The header for all pages (oneside) or for even pages (twoside)
%\renewcommand{\subsectionmark}[1]{\markright{\thesubsection~#1}} % Uncomment when using the twoside option - this modifies the header on odd pages
\lehead{\mbox{\llap{\small\thepage\kern1em\color{halfgray} \vline}\color{halfgray}\hspace{0.5em}\rightmark\hfil}} % The header style

\pagestyle{scrheadings} % Enable the headers specified in this block

%----------------------------------------------------------------------------------------
%	TABLE OF CONTENTS & LISTS OF FIGURES AND TABLES
%----------------------------------------------------------------------------------------

\maketitle % Print the title/author/date block

\newpage

\setcounter{tocdepth}{2} % Set the depth of the table of contents to show sections and subsections only

\tableofcontents % Print the table of contents

\listoffigures % Print the list of figures

\listoftables % Print the list of tables

%----------------------------------------------------------------------------------------
%	ABSTRACT
%----------------------------------------------------------------------------------------

\section*{Abstract} % This section will not appear in the table of contents due to the star (\section*)

\lipsum[1] % Dummy text

%----------------------------------------------------------------------------------------
%	AUTHOR AFFILIATIONS
%----------------------------------------------------------------------------------------

%----------------------------------------------------------------------------------------

\newpage % Start the article content on the second page, remove this if you have a longer abstract that goes onto the second page

%----------------------------------------------------------------------------------------
%	INTRODUCTION
%----------------------------------------------------------------------------------------

\section{Introduction}

La sicurezza negli ultimi anni sta diventando sempre più importante per le comunicazioni, 

c'è sempre più bisogno di realizzare collegamenti sicuri, uno strumento molto utile a questo fine sono le VPN.



\subsection{IPsec}

Introduzione a quello che è ipsec e suo funzionamento

\subsection{IKE}


Importanza di IKE per effettuare lo scambio di chiavi per stabilire la SA.

Concetti su cui si basa IKE

\subsection{Strongswan}

Parlare rapidamente di quello che è
quello che è anche l'architettura di strongswan charon.

%----------------------------------------------------------------------------------------
%	METHODS
%----------------------------------------------------------------------------------------

\section{Setup}

Descrivere come si è deciso di effettuare il testing. Vediamo anche quelle che sono le convenzioni che abbiamo utilizzato nella nostra sperimentazione.

\subsection{Environment}

Confiugrazione delle macchine virtuali utilizzate con KVM. quantità di ram e cpu assegnata, sistema opeartivo su cui si è
effettutato il testing e in particolare la rete in modalità network bridge.


\subsection{Configuration} 

    \dirtree{%
        .1 /etc.
        .2 ipsec.conf.
        .2 ipsec.secret.
        .2 ipsec.d.
        .3 cacerts.
        .3 certs.
        .3 private.
    }
    
\subsubsection*{Certificati}

IKEv2 supporta l'autenticazione tramite certificati, per poter avere dei certificati con delle firme valide occorre generare dei certificati da Root Autority.
Per i test che andremo ad eseguire ci servono due certificati Root CA:
\begin{itemize}
    \item un certificato RSA
    \item un certificato ECDSA
\end{itemize}

\noindent
La caratteristica dei certificati Root CA è che sono autofirmati. Spiegare il perchè

Dunque procediamo con il generare la chiave privata della Root CA:
\begin{lstlisting}
    $ pki --gen --type rsa --size 2048 --outform pem > 'ca.rsa.key.pem'
    $ pki --gen --type ecdsa --size 256 --outform pem > 'ca.ecdsa.key.pem'
\end{lstlisting} 

Andiamo a creare i certificati di chiave pubblica andando ad applicare la chiave private appena generata:

\begin{lstlisting}
    $ pki --self --ca --lifetime 3650 --in 'ca.<type>.key.pem' --type <type> --dn "CN=Root CA" --outform pem > ca.<type>.cert.pem
\end{lstlisting}

Generazione dei certificati, non si possono utilizzare i certificati presenti nel repository perchè sono legati all'IP del responder e dell'initiator.
\begin{lstlisting}
    $ pki --gen --type ecdsa --size 256 --outform pem > '/etc/ipsec.d/private'
\end{lstlisting} 

\subsubsection{Mschap}

\subsubsection{RSA}

\subsubsection{ECDSA}

%------------------------------------------------

%----------------------------------------------------------------------------------------
%	RESULTS AND DISCUSSION
%----------------------------------------------------------------------------------------

\section{Testing}

\subsection{Automating Test}

\subsection{Results}

\section{Conslusioni}
%------------------------------------------------

%----------------------------------------------------------------------------------------
%	BIBLIOGRAPHY
%----------------------------------------------------------------------------------------

\renewcommand{\refname}{\spacedlowsmallcaps{References}} % For modifying the bibliography heading

\bibliographystyle{unsrt}

\bibliography{sample.bib} % The file containing the bibliography

%----------------------------------------------------------------------------------------

\end{document}